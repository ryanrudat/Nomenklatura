//
//  GoalDrivenAgencyService.swift
//  Nomenklatura
//
//  Activates NPC goals as the primary decision driver.
//  NPCs act based on their goals, needs, and memories - not just their relationship to the player.
//

import Foundation
import os.log

private let goalLogger = Logger(subsystem: "com.ryanrudat.Nomenklatura", category: "GoalSystem")

// MARK: - Goal-Driven Agency Service

/// Service that makes NPC goals the primary driver of their behavior
@MainActor
final class GoalDrivenAgencyService {
    static let shared = GoalDrivenAgencyService()

    private let decisionMaker = GoalDrivenDecisionMaker.shared

    private init() {}

    // Track recently used goal types to prevent repetitive events
    private var recentGoalTypes: [NPCGoalType] = []
    private let maxRecentGoalTypes = 5

    // MARK: - Main Evaluation

    /// Evaluate all NPCs for goal-driven actions
    /// Returns events generated by NPCs pursuing their goals
    func evaluateGoalDrivenActions(game: Game) -> [DynamicEvent] {
        // Check if character message events are on cooldown
        if game.isEventTypeOnCooldown(.characterMessage) {
            goalLogger.debug("Character message events on cooldown, skipping goal-driven actions")
            return []
        }

        // Require at least 1 turn between goal events to prevent spam
        // (reduced from 2 to make NPC goals more active)
        if game.lastDynamicEventTurn > 0 && game.turnNumber - game.lastDynamicEventTurn < 1 {
            goalLogger.debug("Recent dynamic event, skipping goal-driven actions for pacing")
            return []
        }

        var events: [DynamicEvent] = []

        // Get all active NPCs with goals, shuffled for variety
        let npcsWithGoals = game.characters.filter { character in
            character.isActive && !character.npcGoals.isEmpty
        }.shuffled()

        for character in npcsWithGoals {
            // Skip characters who recently initiated contact (cooldown of 3 turns per character)
            if let lastTurn = character.lastInitiatedTurn, game.turnNumber - lastTurn < 3 {
                goalLogger.debug("\(character.name) recently initiated contact, skipping")
                continue
            }

            if let event = evaluateCharacterGoals(character, game: game) {
                // Filter by player position - ensure event is appropriate for their rank
                guard event.eventType.isAppropriate(forPositionIndex: game.currentPositionIndex) else {
                    goalLogger.debug("Event type \(event.eventType.rawValue) not appropriate for position \(game.currentPositionIndex), skipping")
                    continue
                }

                events.append(event)

                // Update character's last initiated turn to prevent repeat contacts
                character.lastInitiatedTurn = game.turnNumber

                // Limit to max goal events per turn (but typically just 1)
                if events.count >= GameplayConstants.NPCDecision.maxGoalEventsPerTurn {
                    break
                }
            }
        }

        return events
    }

    /// Evaluate a single character's goals and potentially generate an action
    private func evaluateCharacterGoals(_ character: GameCharacter, game: Game) -> DynamicEvent? {
        guard let primaryGoal = character.primaryGoal else { return nil }

        // Skip if this goal type was used recently (prevents "Seeks Advancement" spam)
        if recentGoalTypes.contains(primaryGoal.goalType) {
            goalLogger.debug("Goal type \(primaryGoal.goalType.displayName) used recently, skipping for variety")
            return nil
        }

        // Create decision context for this goal
        let context = DecisionContext(
            decisionType: mapGoalToDecisionType(primaryGoal.goalType),
            targetCharacterId: primaryGoal.targetCharacterId,
            contextData: [
                "goalId": primaryGoal.id.uuidString,
                "goalProgress": primaryGoal.progress,
                "goalPriority": primaryGoal.effectivePriority(currentTurn: game.turnNumber)
            ]
        )

        // Use goal-driven decision maker to evaluate
        let shouldAct = decisionMaker.shouldAct(
            character: character,
            game: game,
            context: context
        )

        guard shouldAct else {
            // Track failed attempt (frustration may build)
            if primaryGoal.isFrustrated {
                goalLogger.debug("\(character.name) frustrated with goal: \(primaryGoal.goalType.displayName)")
            }
            return nil
        }

        goalLogger.info("\(character.name) acting on goal: \(primaryGoal.goalType.displayName)")

        // Generate event based on goal type
        let event = generateGoalEvent(character: character, goal: primaryGoal, game: game)

        // Track this goal type to prevent repetition
        if event != nil {
            recentGoalTypes.append(primaryGoal.goalType)
            if recentGoalTypes.count > maxRecentGoalTypes {
                recentGoalTypes.removeFirst()
            }
        }

        return event
    }

    // MARK: - Goal Event Generation

    /// Generate an event based on the NPC's goal
    private func generateGoalEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        switch goal.goalType {
        // Ambition Goals
        case .seekPromotion:
            return generatePromotionAttemptEvent(character: character, goal: goal, game: game)
        case .becomeTrackHead, .joinPolitburo:
            return generatePowerGrabEvent(character: character, goal: goal, game: game)
        case .protectPosition:
            return generatePositionDefenseEvent(character: character, goal: goal, game: game)

        // Relationship Goals
        case .destroyRival:
            return generateRivalDestructionEvent(character: character, goal: goal, game: game)
        case .elevateAlly:
            return generateAllyElevationEvent(character: character, goal: goal, game: game)
        case .avengeBetrayal:
            return generateRevengeEvent(character: character, goal: goal, game: game)
        case .repayDebt:
            return generateDebtRepaymentEvent(character: character, goal: goal, game: game)

        // Power Goals
        case .buildFaction:
            return generateFactionBuildingEvent(character: character, goal: goal, game: game)
        case .accumulateWealth:
            return generateCorruptionEvent(character: character, goal: goal, game: game)
        case .expandInfluence:
            return generateInfluenceExpansionEvent(character: character, goal: goal, game: game)

        // Ideological Goals
        case .implementReform:
            return generateReformPushEvent(character: character, goal: goal, game: game)
        case .maintainOrthodoxy:
            return generateOrthodoxyDefenseEvent(character: character, goal: goal, game: game)
        case .purgeEnemies:
            return generatePurgeInitiationEvent(character: character, goal: goal, game: game)

        // Party Devotion Goals
        case .serveTheParty, .defendPartyOrthodoxy:
            return generatePartyServiceEvent(character: character, goal: goal, game: game)
        case .rootOutTraitors:
            return generateTraitorHuntEvent(character: character, goal: goal, game: game)
        case .strengthenTheState:
            return generateStateStrengtheningEvent(character: character, goal: goal, game: game)

        // Espionage Goals
        case .spyForForeignPower:
            return generateEspionageEvent(character: character, goal: goal, game: game)
        case .recruitAssets:
            return generateRecruitmentEvent(character: character, goal: goal, game: game)
        case .sabotageFromWithin:
            return generateSabotageEvent(character: character, goal: goal, game: game)
        case .avoidDetection:
            return generateCoverMaintenanceEvent(character: character, goal: goal, game: game)

        // Survival Goals
        case .avoidPurge:
            return generatePurgeAvoidanceEvent(character: character, goal: goal, game: game)
        case .clearName:
            return generateNameClearingEvent(character: character, goal: goal, game: game)
        case .escapeDetention:
            return generateEscapeAttemptEvent(character: character, goal: goal, game: game)
        case .findProtector:
            return generateProtectorSearchEvent(character: character, goal: goal, game: game)

        // Diplomatic Goals
        case .improveAllyRelations:
            return generateAllyRelationsEvent(character: character, goal: goal, game: game)
        case .containCapitalistThreat:
            return generateContainmentEvent(character: character, goal: goal, game: game)
        case .expandTradeNetwork:
            return generateTradeExpansionEvent(character: character, goal: goal, game: game)
        case .defuseInternationalCrisis:
            return generateCrisisDefusalEvent(character: character, goal: goal, game: game)
        case .advanceIdeologicalGoals:
            return generateIdeologicalAdvancementEvent(character: character, goal: goal, game: game)
        case .proposeForeignPolicy:
            return generateForeignPolicyProposalEvent(character: character, goal: goal, game: game)
        case .negotiateTreaty:
            return generateTreatyNegotiationEvent(character: character, goal: goal, game: game)

        // Security Goals (CCDI/MSS)
        case .investigateCorruption:
            return generateInvestigateCorruptionEvent(character: character, goal: goal, game: game)
        case .expandSurveillance:
            return generateExpandSurveillanceEvent(character: character, goal: goal, game: game)
        case .conductPurge:
            return generateConductPurgeEvent(character: character, goal: goal, game: game)
        case .buildDossiers:
            return generateBuildDossiersEvent(character: character, goal: goal, game: game)
        case .protectPatron:
            return generateProtectPatronEvent(character: character, goal: goal, game: game)
        case .protectRegime:
            return generateProtectRegimeEvent(character: character, goal: goal, game: game)
        case .eliminateRivals:
            return generateEliminateRivalsEvent(character: character, goal: goal, game: game)
        case .huntForeignSpies:
            return generateHuntForeignSpiesEvent(character: character, goal: goal, game: game)

        // Economic Goals (Gosplan)
        case .meetProductionQuotas:
            return generateMeetQuotasEvent(character: character, goal: goal, game: game)
        case .exceedException:
            return generateExceedQuotaEvent(character: character, goal: goal, game: game)
        case .expandIndustrialOutput:
            return generateExpandIndustrialEvent(character: character, goal: goal, game: game)
        case .modernizeSector:
            return generateModernizeSectorEvent(character: character, goal: goal, game: game)
        case .acquireResources:
            return generateAcquireResourcesEvent(character: character, goal: goal, game: game)
        case .protectBudgetAllocation:
            return generateProtectBudgetEvent(character: character, goal: goal, game: game)
        case .buildEconomicNetwork:
            return generateBuildEconomicNetworkEvent(character: character, goal: goal, game: game)
        case .advanceEconomicReform:
            return generateAdvanceEconomicReformEvent(character: character, goal: goal, game: game)

        // Military-Political Goals (PLA Commissar)
        case .ensurePartyCommand:
            return generateEnsurePartyCommandEvent(character: character, goal: goal, game: game)
        case .conductPoliticalWork:
            return generateConductPoliticalWorkEvent(character: character, goal: goal, game: game)
        case .evaluateOfficerLoyalty:
            return generateEvaluateOfficerLoyaltyEvent(character: character, goal: goal, game: game)
        case .purgeDisloyal:
            return generatePurgeDisloyalEvent(character: character, goal: goal, game: game)
        case .enforcePartyDiscipline:
            return generateEnforcePartyDisciplineEvent(character: character, goal: goal, game: game)
        case .buildCommissarNetwork:
            return generateBuildCommissarNetworkEvent(character: character, goal: goal, game: game)
        case .advanceMilitaryReform:
            return generateAdvanceMilitaryReformEvent(character: character, goal: goal, game: game)
        case .preventMilitaryCoup:
            return generatePreventMilitaryCoupEvent(character: character, goal: goal, game: game)

        // Party Apparatus Goals (Organization Department/Central Committee)
        case .controlNomenklatura:
            return generateControlNomenklaturaEvent(character: character, goal: goal, game: game)
        case .enforcePropagandaLine:
            return generateEnforcePropagandaLineEvent(character: character, goal: goal, game: game)
        case .conductUnitedFrontWork:
            return generateConductUnitedFrontWorkEvent(character: character, goal: goal, game: game)
        case .runPartySchool:
            return generateRunPartySchoolEvent(character: character, goal: goal, game: game)
        case .maintainPartyDiscipline:
            return generateMaintainPartyDisciplineEvent(character: character, goal: goal, game: game)
        case .expandPartyInfluence:
            return generateExpandPartyInfluenceEvent(character: character, goal: goal, game: game)
        case .buildCadreNetwork:
            return generateBuildCadreNetworkEvent(character: character, goal: goal, game: game)
        case .purgeDeviationists:
            return generatePurgeDeviationistsEvent(character: character, goal: goal, game: game)

        // State Ministry Goals
        case .achieveAdministrativeExcellence:
            return generateAdministrativeExcellenceEvent(character: character, goal: goal, game: game)
        case .secureBudgetAllocation:
            return generateSecureBudgetEvent(character: character, goal: goal, game: game)
        case .advanceMajorProject:
            return generateAdvanceProjectEvent(character: character, goal: goal, game: game)
        case .coordinateAcrossMinistries:
            return generateCoordinateMinistriesEvent(character: character, goal: goal, game: game)
        case .implementStatePolicy:
            return generateImplementStatePolicyEvent(character: character, goal: goal, game: game)
        case .auditSubordinateUnits:
            return generateAuditUnitsEvent(character: character, goal: goal, game: game)
        case .modernizeAdministration:
            return generateModernizeAdminEvent(character: character, goal: goal, game: game)
        case .buildBureaucraticNetwork:
            return generateBuildBureaucraticNetworkEvent(character: character, goal: goal, game: game)
        }
    }

    // MARK: - Ambition Goal Events

    private func generatePromotionAttemptEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        let frustrated = goal.isFrustrated

        // Check if character might approach player for help
        guard character.disposition >= 50 && !character.isRival else { return nil }

        let title = frustrated ? "\(character.name) Makes Bold Move" : "\(character.name) Seeks Advancement"
        let text = frustrated
            ? "\(character.name) has grown frustrated with their stalled career. They're considering drastic action to secure a promotion, and have approached you about potentially supporting their candidacy."
            : "\(character.name) has been working to position themselves for advancement. They've come to discuss their ambitions with you - perhaps seeking your endorsement."

        return DynamicEvent(
            eventType: .characterMessage,
            priority: frustrated ? .elevated : .normal,
            title: title,
            briefText: text,
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "support_\(character.id)",
                    text: "Offer your support",
                    shortText: "Support",
                    effects: ["network": 5, "standing": frustrated ? -5 : 0]
                ),
                EventResponse(
                    id: "decline_\(character.id)",
                    text: "Decline to get involved",
                    shortText: "Decline",
                    effects: [:]
                ),
                EventResponse(
                    id: "obstruct_\(character.id)",
                    text: "Subtly obstruct their advancement",
                    shortText: "Obstruct",
                    effects: ["standing": 3]
                )
            ],
            iconName: "arrow.up.circle.fill",
            accentColor: "accentGold"
        )
    }

    private func generatePowerGrabEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        guard goal.effectivePriority(currentTurn: game.turnNumber) > 60 else { return nil }

        let positionName = goal.goalType == .joinPolitburo ? "Politburo" : "Track Leadership"

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Power Struggle: \(character.name)",
            briefText: "\(character.name) is making moves toward the \(positionName). Their ambition has become increasingly apparent, causing ripples through the hierarchy. You must decide how to respond to this developing situation.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "ally_power",
                    text: "Align with their bid for power",
                    shortText: "Ally",
                    effects: ["standing": (character.positionIndex ?? 0) > 5 ? 5 : -3]
                ),
                EventResponse(
                    id: "oppose_power",
                    text: "Work to block their advancement",
                    shortText: "Oppose",
                    effects: ["standing": 5]
                ),
                EventResponse(
                    id: "observe_power",
                    text: "Watch and wait",
                    shortText: "Observe",
                    effects: [:]
                )
            ],
            iconName: "crown.fill",
            accentColor: "sovietRed"
        )
    }

    private func generatePositionDefenseEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Character is defending their position - they might seek alliances
        guard character.npcNeeds.securityCritical || goal.isFrustrated else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "\(character.name) Seeks Support",
            briefText: "Feeling their position threatened, \(character.name) has reached out to consolidate support. They're offering favors and making promises to secure their standing in the hierarchy.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "support_defense",
                    text: "Offer your backing",
                    shortText: "Support",
                    effects: ["network": 3]
                ),
                EventResponse(
                    id: "exploit_defense",
                    text: "Extract concessions for support",
                    shortText: "Extract Concessions",
                    effects: ["influence": 5]
                ),
                EventResponse(
                    id: "refuse_defense",
                    text: "Decline to commit",
                    shortText: "Decline",
                    effects: [:]
                )
            ],
            iconName: "shield.fill",
            accentColor: "accentGold"
        )
    }

    // MARK: - Relationship Goal Events

    private func generateRivalDestructionEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        guard let targetId = goal.targetCharacterId,
              let target = game.characters.first(where: { $0.id.uuidString == targetId }) else { return nil }

        // Character is moving against their rival
        guard character.disposition >= 40 && target.id.uuidString != "player" else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "\(character.name) Plots Against \(target.name)",
            briefText: "\(character.name) is planning to move against \(target.name). They've shared their intentions with you, perhaps seeking your involvement or at least your neutrality in the coming conflict.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "join_plot",
                    text: "Join the plot against \(target.name)",
                    shortText: "Join Plot",
                    effects: ["standing": -3]
                ),
                EventResponse(
                    id: "warn_target",
                    text: "Warn \(target.name) of the plot",
                    shortText: "Warn Target",
                    effects: ["standing": 3]
                ),
                EventResponse(
                    id: "stay_neutral",
                    text: "Remain neutral",
                    shortText: "Stay Neutral",
                    effects: [:]
                )
            ],
            iconName: "bolt.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateAllyElevationEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        guard let targetId = goal.targetCharacterId,
              let ally = game.characters.first(where: { $0.id.uuidString == targetId }) else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "\(character.name) Champions \(ally.name)",
            briefText: "\(character.name) has been working to advance \(ally.name)'s career. Their efforts to build support for their ally have become noticeable, and they've asked for your opinion on \(ally.name)'s potential.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "endorse",
                    text: "Endorse \(ally.name)",
                    shortText: "Endorse",
                    effects: ["network": 3]
                ),
                EventResponse(
                    id: "criticize",
                    text: "Express doubts about \(ally.name)",
                    shortText: "Express Doubts",
                    effects: [:]
                ),
                EventResponse(
                    id: "neutral",
                    text: "Offer no opinion",
                    shortText: "No Opinion",
                    effects: [:]
                )
            ],
            iconName: "person.2.fill",
            accentColor: "accentGold"
        )
    }

    private func generateRevengeEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        guard let targetId = goal.targetCharacterId,
              let target = game.characters.first(where: { $0.id.uuidString == targetId }) else { return nil }

        // Check character's memories for the betrayal
        let betrayalMemories = character.npcMemoriesEnhanced.filter {
            $0.involvedCharacterId == targetId && $0.memoryType.isNegative
        }

        guard !betrayalMemories.isEmpty else { return nil }

        let grievance = betrayalMemories.first?.description ?? "past wrongs"

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "\(character.name)'s Vendetta",
            briefText: "\(character.name) has not forgotten \(grievance). They are now preparing to settle old scores with \(target.name). The tension between them has become palpable.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "support_revenge",
                    text: "Support \(character.name)'s vendetta",
                    shortText: "Support",
                    effects: ["standing": -5]
                ),
                EventResponse(
                    id: "mediate",
                    text: "Try to mediate the conflict",
                    shortText: "Mediate",
                    effects: ["standing": 5]
                ),
                EventResponse(
                    id: "ignore",
                    text: "Stay out of it",
                    shortText: "Stay Out",
                    effects: [:]
                )
            ],
            iconName: "flame.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateDebtRepaymentEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        guard let targetId = goal.targetCharacterId else { return nil }

        // Only generate if target is player
        guard targetId == "player" else { return nil }

        return DynamicEvent(
            eventType: .allyRequest,
            priority: .normal,
            title: "\(character.name) Offers Assistance",
            briefText: "\(character.name) remembers the help you provided in the past. They've come with an offer to repay that debt - information, support, or perhaps something more tangible.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "accept_help",
                    text: "Accept their help gratefully",
                    shortText: "Accept",
                    effects: ["network": 5, "influence": 3]
                ),
                EventResponse(
                    id: "bank_favor",
                    text: "Thank them but save the favor for later",
                    shortText: "Save Favor",
                    effects: [:]
                ),
                EventResponse(
                    id: "forgive_debt",
                    text: "Tell them the debt is forgiven",
                    shortText: "Forgive",
                    effects: ["standing": 3]
                )
            ],
            iconName: "gift.fill",
            accentColor: "accentGold"
        )
    }

    // MARK: - Power Goal Events

    private func generateFactionBuildingEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        guard let factionId = character.factionId,
              let faction = game.factions.first(where: { $0.factionId == factionId }) else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "\(faction.name) Expansion",
            briefText: "\(character.name) is working to strengthen the \(faction.name). They're recruiting supporters and building alliances. You've been approached to gauge your interest in closer ties with the faction.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "join_faction",
                    text: "Express interest in joining",
                    shortText: "Join",
                    effects: ["network": 5]
                ),
                EventResponse(
                    id: "polite_decline",
                    text: "Politely decline",
                    shortText: "Decline",
                    effects: [:]
                ),
                EventResponse(
                    id: "oppose_faction",
                    text: "Warn others about faction's ambitions",
                    shortText: "Warn Others",
                    effects: ["standing": -5]
                )
            ],
            iconName: "person.3.fill",
            accentColor: "accentGold"
        )
    }

    private func generateCorruptionEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Only generate if player might discover
        guard Int.random(in: 0...100) < 30 else { return nil }

        return DynamicEvent(
            eventType: .networkIntel,
            priority: .elevated,
            title: "Suspicious Activities",
            briefText: "You've noticed \(character.name) engaging in what appear to be suspicious financial activities. State resources may be being diverted for personal gain.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "report",
                    text: "Report to security services",
                    shortText: "Report",
                    effects: ["standing": 5, "partyOrthodoxy": 3]
                ),
                EventResponse(
                    id: "confront",
                    text: "Confront them privately",
                    shortText: "Confront",
                    effects: [:]
                ),
                EventResponse(
                    id: "blackmail",
                    text: "Use this knowledge for leverage",
                    shortText: "Leverage",
                    effects: ["influence": 10]
                ),
                EventResponse(
                    id: "ignore",
                    text: "Look the other way",
                    shortText: "Ignore",
                    effects: [:]
                )
            ],
            iconName: "banknote.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateInfluenceExpansionEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "\(character.name) Expanding Network",
            briefText: "\(character.name) has been building relationships throughout the apparatus. Their growing influence is becoming noticeable. They've reached out to you, perhaps seeing potential mutual benefit.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "collaborate",
                    text: "Collaborate on mutual interests",
                    shortText: "Collaborate",
                    effects: ["network": 5]
                ),
                EventResponse(
                    id: "compete",
                    text: "View them as competition",
                    shortText: "Compete",
                    effects: [:]
                ),
                EventResponse(
                    id: "ignore",
                    text: "Show no interest",
                    shortText: "Ignore",
                    effects: [:]
                )
            ],
            iconName: "network",
            accentColor: "accentGold"
        )
    }

    // MARK: - Ideological Goal Events

    private func generateReformPushEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "\(character.name) Advocates Reform",
            briefText: "\(character.name) has been circulating ideas for reform within the Party. Their proposals touch on sensitive topics - economic liberalization, cultural opening, or administrative efficiency. They seek your thoughts.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "support_reform",
                    text: "Express support for reforms",
                    shortText: "Support",
                    effects: ["partyOrthodoxy": -5]
                ),
                EventResponse(
                    id: "oppose_reform",
                    text: "Defend orthodox positions",
                    shortText: "Defend Orthodoxy",
                    effects: ["partyOrthodoxy": 5]
                ),
                EventResponse(
                    id: "suggest_caution",
                    text: "Suggest more cautious approach",
                    shortText: "Caution",
                    effects: [:]
                )
            ],
            iconName: "arrow.triangle.2.circlepath",
            accentColor: "accentGold"
        )
    }

    private func generateOrthodoxyDefenseEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "\(character.name) Defends Orthodoxy",
            briefText: "\(character.name) has been vocal about maintaining ideological purity. They're rallying support against what they see as dangerous revisionism creeping into the Party.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "join_defense",
                    text: "Join the defense of orthodoxy",
                    shortText: "Join",
                    effects: ["partyOrthodoxy": 5]
                ),
                EventResponse(
                    id: "question",
                    text: "Question their rigid approach",
                    shortText: "Question",
                    effects: ["partyOrthodoxy": -3]
                ),
                EventResponse(
                    id: "neutral",
                    text: "Remain neutral on ideological debates",
                    shortText: "Neutral",
                    effects: [:]
                )
            ],
            iconName: "book.closed.fill",
            accentColor: "sovietRed"
        )
    }

    private func generatePurgeInitiationEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Only if character has high position and low stability
        guard (character.positionIndex ?? 0) >= 5 && game.stability < 50 else { return nil }

        return DynamicEvent(
            eventType: .urgentInterruption,
            priority: .critical,
            title: "Calls for Purification",
            briefText: "\(character.name) is calling for a campaign to remove 'enemies' from the Party ranks. They claim to have evidence of widespread disloyalty and demand action. The atmosphere is becoming tense.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: true,
            responseOptions: [
                EventResponse(
                    id: "support_purge",
                    text: "Support the purification campaign",
                    shortText: "Support Purge",
                    effects: ["stability": -10, "partyOrthodoxy": 10]
                ),
                EventResponse(
                    id: "oppose_purge",
                    text: "Argue against witch hunts",
                    shortText: "Oppose",
                    effects: ["stability": 5, "standing": -5]
                ),
                EventResponse(
                    id: "redirect",
                    text: "Suggest focusing on external enemies instead",
                    shortText: "Redirect",
                    effects: ["stability": 3]
                )
            ],
            iconName: "exclamationmark.triangle.fill",
            accentColor: "sovietRed"
        )
    }

    // MARK: - Party Devotion Goal Events

    private func generatePartyServiceEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "\(character.name)'s Dedication",
            briefText: "\(character.name) has thrown themselves into Party work with exceptional dedication. Their tireless efforts have been noticed, and they've approached you about a project they believe will strengthen the Party.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "collaborate",
                    text: "Collaborate on their project",
                    shortText: "Collaborate",
                    effects: ["partyOrthodoxy": 3]
                ),
                EventResponse(
                    id: "defer",
                    text: "Express appreciation but decline",
                    shortText: "Decline",
                    effects: [:]
                )
            ],
            iconName: "star.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateTraitorHuntEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Pick a random potential "suspect"
        let suspects = game.characters.filter { $0.isActive && $0.id != character.id && $0.disposition < 50 }
        guard let suspect = suspects.randomElement() else { return nil }

        return DynamicEvent(
            eventType: .networkIntel,
            priority: .elevated,
            title: "Accusations of Disloyalty",
            briefText: "\(character.name) has been investigating potential traitors and has shared their suspicions about \(suspect.name) with you. They claim to have evidence of disloyalty to the Party.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "support_investigation",
                    text: "Support the investigation",
                    shortText: "Support",
                    effects: ["partyOrthodoxy": 5]
                ),
                EventResponse(
                    id: "demand_proof",
                    text: "Demand concrete evidence",
                    shortText: "Demand Proof",
                    effects: [:]
                ),
                EventResponse(
                    id: "defend_suspect",
                    text: "Defend \(suspect.name)",
                    shortText: "Defend",
                    effects: ["standing": -3]
                )
            ],
            iconName: "eye.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateStateStrengtheningEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Strengthening State Capacity",
            briefText: "\(character.name) has proposed initiatives to strengthen state capacity - improved economic planning, enhanced security apparatus, or more effective governance. They seek support for their proposals.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "support",
                    text: "Support their proposals",
                    shortText: "Support",
                    effects: ["stability": 3]
                ),
                EventResponse(
                    id: "modify",
                    text: "Suggest modifications",
                    shortText: "Modify",
                    effects: [:]
                ),
                EventResponse(
                    id: "oppose",
                    text: "Oppose expansion of state power",
                    shortText: "Oppose",
                    effects: [:]
                )
            ],
            iconName: "building.columns.fill",
            accentColor: "accentGold"
        )
    }

    // MARK: - Espionage Goal Events

    private func generateEspionageEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Player might discover spy activity
        guard character.foreignAgentStatus.isForeignAgent else { return nil }
        guard Int.random(in: 0...100) < character.foreignAgentStatus.detectionRisk else { return nil }

        return DynamicEvent(
            eventType: .networkIntel,
            priority: .elevated,
            title: "Suspicious Behavior",
            briefText: "You've noticed \(character.name) behaving oddly - unexplained absences, secretive meetings, unusual interest in sensitive information. Something doesn't add up.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "report_spy",
                    text: "Report suspicions to security",
                    shortText: "Report",
                    effects: ["standing": 10]
                ),
                EventResponse(
                    id: "investigate_privately",
                    text: "Investigate privately first",
                    shortText: "Investigate",
                    effects: [:]
                ),
                EventResponse(
                    id: "confront",
                    text: "Confront them directly",
                    shortText: "Confront",
                    effects: [:]
                ),
                EventResponse(
                    id: "ignore",
                    text: "It's probably nothing",
                    shortText: "Ignore",
                    effects: [:]
                )
            ],
            iconName: "eye.slash.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateRecruitmentEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        guard character.foreignAgentStatus.isForeignAgent else { return nil }

        // Spy attempting to recruit player
        guard character.disposition >= 30 && game.patronFavor < 40 else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .critical,
            title: "An Unusual Approach",
            briefText: "\(character.name) has approached you with an unusual proposition. They hint at connections abroad, speak of opportunities, and suggest that your current position is undervalued. The implications are clear but unspoken.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: true,
            responseOptions: [
                EventResponse(
                    id: "report_immediately",
                    text: "Report the approach to security immediately",
                    shortText: "Report",
                    effects: ["standing": 15, "partyOrthodoxy": 10]
                ),
                EventResponse(
                    id: "string_along",
                    text: "Pretend interest to gather information",
                    shortText: "Play Along",
                    effects: ["influence": 5]
                ),
                EventResponse(
                    id: "refuse_quietly",
                    text: "Firmly refuse but don't report",
                    shortText: "Refuse",
                    effects: [:]
                )
            ],
            iconName: "exclamationmark.shield.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateSabotageEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        guard character.foreignAgentStatus.isForeignAgent else { return nil }
        guard character.foreignAgentStatus.sabotageActs > 0 else { return nil }

        // Sabotage discovered
        return DynamicEvent(
            eventType: .urgentInterruption,
            priority: .critical,
            title: "Industrial Accident",
            briefText: "A significant accident has occurred at a state facility. Initial reports suggest equipment failure, but some whisper about sabotage. Fingers are being pointed in various directions.",
            turnGenerated: game.turnNumber,
            isUrgent: true,
            responseOptions: [
                EventResponse(
                    id: "investigate",
                    text: "Call for thorough investigation",
                    shortText: "Investigate",
                    effects: ["stability": -5]
                ),
                EventResponse(
                    id: "blame_incompetence",
                    text: "Blame bureaucratic incompetence",
                    shortText: "Blame System",
                    effects: ["stability": 3]
                ),
                EventResponse(
                    id: "cover_up",
                    text: "Help minimize the incident",
                    shortText: "Cover Up",
                    effects: [:]
                )
            ],
            iconName: "exclamationmark.triangle.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateCoverMaintenanceEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Usually invisible to player - only if very close
        guard character.foreignAgentStatus.isForeignAgent else { return nil }
        guard character.disposition >= 60 else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "A Confidential Request",
            briefText: "\(character.name) has asked you a strange favor - they need you to provide an alibi for an evening last week, or perhaps vouch for their whereabouts during a recent conference. The request seems oddly urgent.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "help",
                    text: "Help them without asking questions",
                    shortText: "Help",
                    effects: [:]
                ),
                EventResponse(
                    id: "demand_explanation",
                    text: "Demand an explanation first",
                    shortText: "Demand Explanation",
                    effects: [:]
                ),
                EventResponse(
                    id: "refuse",
                    text: "Refuse to get involved",
                    shortText: "Refuse",
                    effects: [:]
                )
            ],
            iconName: "questionmark.circle.fill",
            accentColor: "accentGold"
        )
    }

    // MARK: - Survival Goal Events

    private func generatePurgeAvoidanceEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        guard character.npcNeeds.securityCritical else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "\(character.name) Seeks Protection",
            briefText: "Fearing for their position, \(character.name) has approached you seeking protection. They believe they may be targeted in coming political struggles and are willing to offer much in exchange for your support.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "protect",
                    text: "Offer your protection",
                    shortText: "Protect",
                    effects: ["network": 5]
                ),
                EventResponse(
                    id: "extract_price",
                    text: "Offer protection at a price",
                    shortText: "Extract Price",
                    effects: ["influence": 5]
                ),
                EventResponse(
                    id: "refuse",
                    text: "Can't risk association with them",
                    shortText: "Refuse",
                    effects: [:]
                )
            ],
            iconName: "shield.fill",
            accentColor: "accentGold"
        )
    }

    private func generateNameClearingEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "\(character.name) Proclaims Innocence",
            briefText: "\(character.name) is fighting to clear their name from allegations. They claim to have proof of their innocence and are seeking allies who will speak on their behalf before the investigation concludes.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "vouch",
                    text: "Vouch for their character",
                    shortText: "Vouch",
                    effects: ["standing": -3]
                ),
                EventResponse(
                    id: "wait",
                    text: "Wait for investigation results",
                    shortText: "Wait",
                    effects: [:]
                ),
                EventResponse(
                    id: "distance",
                    text: "Distance yourself from them",
                    shortText: "Distance",
                    effects: ["standing": 3]
                )
            ],
            iconName: "hand.raised.fill",
            accentColor: "accentGold"
        )
    }

    private func generateEscapeAttemptEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Only if character is detained/under investigation
        guard character.status == CharacterStatus.detained.rawValue || character.isUnderInvestigation else { return nil }

        return DynamicEvent(
            eventType: .urgentInterruption,
            priority: .critical,
            title: "Escape Attempt",
            briefText: "Word has reached you that \(character.name) has attempted to flee custody. Security forces are conducting a manhunt. You've been asked if you have any information about their potential whereabouts.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: true,
            responseOptions: [
                EventResponse(
                    id: "help_search",
                    text: "Help with the search",
                    shortText: "Help Search",
                    effects: ["standing": 5]
                ),
                EventResponse(
                    id: "know_nothing",
                    text: "Claim to know nothing",
                    shortText: "Know Nothing",
                    effects: [:]
                ),
                EventResponse(
                    id: "secretly_help",
                    text: "Secretly provide aid",
                    shortText: "Secret Aid",
                    effects: ["standing": -10]
                )
            ],
            iconName: "figure.run",
            accentColor: "sovietRed"
        )
    }

    private func generateProtectorSearchEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Character seeking a patron relationship
        guard character.npcNeeds.securityCritical || goal.effectivePriority(currentTurn: game.turnNumber) > 70 else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "\(character.name) Seeks Patronage",
            briefText: "\(character.name) has approached you seeking a patron-client relationship. They offer their loyalty and service in exchange for protection and advancement opportunities.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "accept_client",
                    text: "Accept them as a client",
                    shortText: "Accept",
                    effects: ["network": 5, "influence": 3]
                ),
                EventResponse(
                    id: "refuse_politely",
                    text: "Decline politely",
                    shortText: "Decline",
                    effects: [:]
                ),
                EventResponse(
                    id: "refer_elsewhere",
                    text: "Suggest they approach someone else",
                    shortText: "Refer",
                    effects: [:]
                )
            ],
            iconName: "person.badge.shield.checkmark.fill",
            accentColor: "accentGold"
        )
    }

    // MARK: - Diplomatic Goal Events

    private func generateAllyRelationsEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Find a socialist ally that could use improved relations
        guard let allyCountry = game.foreignCountries.first(where: {
            $0.politicalBloc == .socialist && $0.relationshipScore < 70
        }) else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Proposal: Strengthen \(allyCountry.name) Ties",
            briefText: "\(character.name) has prepared a diplomatic initiative to strengthen relations with \(allyCountry.name). They propose cultural exchanges, economic cooperation, and high-level visits to deepen the socialist brotherhood.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "support_initiative",
                    text: "Support the initiative",
                    shortText: "Support",
                    effects: ["standing": 3]
                ),
                EventResponse(
                    id: "suggest_caution",
                    text: "Suggest a more cautious approach",
                    shortText: "Caution",
                    effects: [:]
                ),
                EventResponse(
                    id: "oppose_costs",
                    text: "Object to the resource costs",
                    shortText: "Object",
                    effects: ["standing": -3]
                )
            ],
            iconName: "handshake.fill",
            accentColor: "accentGold"
        )
    }

    private func generateContainmentEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Find a capitalist threat
        guard let threatCountry = game.foreignCountries.first(where: {
            $0.politicalBloc == .capitalist && $0.diplomaticTension > 40
        }) else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Containment Strategy: \(threatCountry.name)",
            briefText: "\(character.name) warns that \(threatCountry.name) is expanding its influence in our sphere. They propose countermeasures: increased propaganda, economic pressure on their allies, and strengthening our intelligence networks.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "aggressive_containment",
                    text: "Approve aggressive countermeasures",
                    shortText: "Aggressive",
                    effects: ["stability": -3]
                ),
                EventResponse(
                    id: "measured_response",
                    text: "Approve a measured response",
                    shortText: "Measured",
                    effects: [:]
                ),
                EventResponse(
                    id: "oppose_escalation",
                    text: "Warn against escalation",
                    shortText: "De-escalate",
                    effects: ["standing": 3]
                )
            ],
            iconName: "shield.lefthalf.filled",
            accentColor: "sovietRed"
        )
    }

    private func generateTradeExpansionEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Find potential trade partner
        guard let tradePartner = game.foreignCountries.first(where: {
            $0.politicalBloc != .capitalist && $0.relationshipScore > 30
        }) else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Trade Proposal: \(tradePartner.name)",
            briefText: "\(character.name) has identified opportunities for expanded trade with \(tradePartner.name). The deal would exchange our industrial goods for their raw materials, potentially benefiting both economies.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "approve_trade",
                    text: "Approve the trade initiative",
                    shortText: "Approve",
                    effects: ["standing": 3]
                ),
                EventResponse(
                    id: "negotiate_terms",
                    text: "Demand better terms first",
                    shortText: "Better Terms",
                    effects: [:]
                ),
                EventResponse(
                    id: "reject_trade",
                    text: "Reject as not in our interest",
                    shortText: "Reject",
                    effects: [:]
                )
            ],
            iconName: "arrow.left.arrow.right",
            accentColor: "accentGold"
        )
    }

    private func generateCrisisDefusalEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Find a country with high tension
        guard let crisisCountry = game.foreignCountries.first(where: {
            $0.diplomaticTension > 60
        }) else { return nil }

        return DynamicEvent(
            eventType: .urgentInterruption,
            priority: .critical,
            title: "Crisis: \(crisisCountry.name) Tensions",
            briefText: "Tensions with \(crisisCountry.name) have reached dangerous levels. \(character.name) proposes emergency diplomatic measures: back-channel negotiations, mutual troop withdrawals, or third-party mediation. Swift action is needed.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: true,
            responseOptions: [
                EventResponse(
                    id: "back_channel",
                    text: "Authorize secret negotiations",
                    shortText: "Secret Talks",
                    effects: ["stability": 5]
                ),
                EventResponse(
                    id: "public_gesture",
                    text: "Make a public peace gesture",
                    shortText: "Public Gesture",
                    effects: ["standing": 5]
                ),
                EventResponse(
                    id: "stand_firm",
                    text: "Stand firm - show no weakness",
                    shortText: "Stand Firm",
                    effects: ["stability": -5]
                )
            ],
            iconName: "exclamationmark.triangle.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateIdeologicalAdvancementEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "International Socialist Solidarity",
            briefText: "\(character.name) proposes expanding our support for socialist movements abroad. This includes increased propaganda, training for fraternal parties, and economic aid to developing socialist nations.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "expand_support",
                    text: "Expand international support",
                    shortText: "Expand",
                    effects: ["partyOrthodoxy": 5]
                ),
                EventResponse(
                    id: "maintain_current",
                    text: "Maintain current levels",
                    shortText: "Maintain",
                    effects: [:]
                ),
                EventResponse(
                    id: "focus_domestic",
                    text: "Focus resources domestically",
                    shortText: "Focus Home",
                    effects: ["partyOrthodoxy": -3]
                )
            ],
            iconName: "globe.europe.africa.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateForeignPolicyProposalEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Only for senior Foreign Affairs officials
        guard (character.positionIndex ?? 0) >= 5 else { return nil }

        let policies = [
            ("Non-Intervention Doctrine", "limits our military commitments abroad"),
            ("Active Defense Policy", "authorizes preemptive action against threats"),
            ("Economic Diplomacy First", "prioritizes trade over military posturing"),
            ("Socialist Unity Policy", "mandates support for all socialist states")
        ]
        let policy = policies.randomElement() ?? policies[0]

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Policy Proposal: \(policy.0)",
            briefText: "\(character.name) has proposed a new foreign policy doctrine: the \(policy.0). This policy \(policy.1). The Standing Committee will need to vote on this significant shift.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "support_policy",
                    text: "Support the proposal",
                    shortText: "Support",
                    effects: ["standing": 5]
                ),
                EventResponse(
                    id: "oppose_policy",
                    text: "Oppose the proposal",
                    shortText: "Oppose",
                    effects: [:]
                ),
                EventResponse(
                    id: "amend_policy",
                    text: "Propose amendments",
                    shortText: "Amend",
                    effects: ["network": 3]
                )
            ],
            iconName: "doc.text.fill",
            accentColor: "accentGold"
        )
    }

    private func generateTreatyNegotiationEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Find a potential treaty partner
        guard let partner = game.foreignCountries.first(where: {
            $0.relationshipScore > 40 && $0.politicalBloc != .capitalist
        }) else { return nil }

        let treatyTypes = [
            ("Mutual Defense Treaty", "commits both nations to military support"),
            ("Trade and Commerce Agreement", "establishes preferential trade terms"),
            ("Cultural Exchange Program", "promotes educational and artistic cooperation"),
            ("Non-Aggression Pact", "guarantees peaceful relations")
        ]
        let treaty = treatyTypes.randomElement() ?? treatyTypes[0]

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Treaty Proposal: \(partner.name)",
            briefText: "\(character.name) has been negotiating with \(partner.name) officials. They report that a \(treaty.0) is within reach. This agreement \(treaty.1). Your input is requested before finalization.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "approve_treaty",
                    text: "Approve the treaty",
                    shortText: "Approve",
                    effects: ["standing": 5]
                ),
                EventResponse(
                    id: "demand_changes",
                    text: "Demand more favorable terms",
                    shortText: "Better Terms",
                    effects: [:]
                ),
                EventResponse(
                    id: "reject_treaty",
                    text: "Reject the treaty",
                    shortText: "Reject",
                    effects: ["standing": -3]
                )
            ],
            iconName: "signature",
            accentColor: "accentGold"
        )
    }

    // MARK: - Security Goal Events (CCDI/MSS)

    private func generateInvestigateCorruptionEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Security NPC investigating corruption - find a corrupt target
        let corruptOfficials = game.characters.filter { other in
            other.isActive &&
            other.id != character.id &&
            other.personality.corrupt > 60 &&
            (other.positionIndex ?? 0) >= 3
        }
        guard let target = corruptOfficials.randomElement() else { return nil }

        return DynamicEvent(
            eventType: .networkIntel,
            priority: .elevated,
            title: "CCDI Investigation: \(target.name)",
            briefText: "\(character.name) from the security services has opened an investigation into \(target.name). They've shared preliminary findings with you: suspicious financial activities, unexplained assets, and questionable associations. Your position has been noted.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "support_investigation",
                    text: "Support the investigation",
                    shortText: "Support",
                    effects: ["standing": 5, "partyOrthodoxy": 3]
                ),
                EventResponse(
                    id: "provide_intel",
                    text: "Provide additional intelligence",
                    shortText: "Provide Intel",
                    effects: ["network": -3, "standing": 8]
                ),
                EventResponse(
                    id: "warn_target",
                    text: "Discreetly warn \(target.name)",
                    shortText: "Warn Target",
                    effects: ["standing": -10]
                ),
                EventResponse(
                    id: "stay_neutral",
                    text: "Stay out of security matters",
                    shortText: "Neutral",
                    effects: [:]
                )
            ],
            iconName: "magnifyingglass",
            accentColor: "sovietRed"
        )
    }

    private func generateExpandSurveillanceEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Security NPC wants to expand surveillance - needs support
        guard (character.positionIndex ?? 0) >= 4 else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Proposal: Enhanced Surveillance",
            briefText: "\(character.name) is proposing expanded surveillance capabilities for the security apparatus. They argue that current monitoring is insufficient to detect enemy activities and corruption. The proposal would increase resources for the State Protection Bureau.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "approve_expansion",
                    text: "Approve the expansion",
                    shortText: "Approve",
                    effects: ["stability": 3, "standing": -3]
                ),
                EventResponse(
                    id: "limited_approval",
                    text: "Approve limited expansion only",
                    shortText: "Limited",
                    effects: [:]
                ),
                EventResponse(
                    id: "reject_proposal",
                    text: "Reject as overreach",
                    shortText: "Reject",
                    effects: ["stability": -3, "standing": 3]
                )
            ],
            iconName: "eye.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateConductPurgeEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Senior security official recommending a purge/anti-corruption campaign
        guard (character.positionIndex ?? 0) >= 5 else { return nil }

        // Find a faction or sector to target
        let factions = game.factions.filter { $0.power > 30 }
        guard let targetFaction = factions.randomElement() else { return nil }

        return DynamicEvent(
            eventType: .urgentInterruption,
            priority: .critical,
            title: "Anti-Corruption Campaign Proposed",
            briefText: "\(character.name) is calling for a comprehensive anti-corruption campaign targeting the \(targetFaction.name) faction. They present evidence of widespread malfeasance and argue that decisive action is necessary to preserve Party discipline.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: true,
            responseOptions: [
                EventResponse(
                    id: "launch_campaign",
                    text: "Launch the campaign",
                    shortText: "Launch",
                    effects: ["stability": -15, "partyOrthodoxy": 10]
                ),
                EventResponse(
                    id: "targeted_action",
                    text: "Authorize targeted action only",
                    shortText: "Targeted",
                    effects: ["stability": -5, "partyOrthodoxy": 5]
                ),
                EventResponse(
                    id: "oppose_campaign",
                    text: "Block the campaign",
                    shortText: "Block",
                    effects: ["stability": 5, "standing": -5]
                )
            ],
            iconName: "exclamationmark.shield.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateBuildDossiersEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Security NPC building files on officials
        guard let targetId = goal.targetCharacterId,
              let target = game.characters.first(where: { $0.id.uuidString == targetId }) else { return nil }

        return DynamicEvent(
            eventType: .networkIntel,
            priority: .elevated,
            title: "Dossier: \(target.name)",
            briefText: "\(character.name) has been compiling a comprehensive dossier on \(target.name). They've shared portions with you - details of associations, financial records, private communications. The information could be powerful leverage.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "accept_dossier",
                    text: "Accept the intelligence",
                    shortText: "Accept",
                    effects: ["influence": 5]
                ),
                EventResponse(
                    id: "use_against_target",
                    text: "Use it against \(target.name)",
                    shortText: "Use It",
                    effects: ["standing": -5]
                ),
                EventResponse(
                    id: "refuse_involvement",
                    text: "Refuse involvement in surveillance",
                    shortText: "Refuse",
                    effects: ["standing": 3]
                )
            ],
            iconName: "doc.text.magnifyingglass",
            accentColor: "accentGold"
        )
    }

    private func generateProtectPatronEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        guard let patronId = goal.targetCharacterId,
              let patron = game.characters.first(where: { $0.id.uuidString == patronId }) else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Security Cover for \(patron.name)",
            briefText: "\(character.name) is working to shield \(patron.name) from security scrutiny. They've approached you to gauge whether you might cooperate - or whether you pose a threat to their protective efforts.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "cooperate",
                    text: "Agree to cooperation",
                    shortText: "Cooperate",
                    effects: ["network": 3]
                ),
                EventResponse(
                    id: "report_coverup",
                    text: "Report the cover-up attempt",
                    shortText: "Report",
                    effects: ["standing": 10, "partyOrthodoxy": 5]
                ),
                EventResponse(
                    id: "stay_silent",
                    text: "Neither help nor hinder",
                    shortText: "Silent",
                    effects: [:]
                )
            ],
            iconName: "shield.slash.fill",
            accentColor: "accentGold"
        )
    }

    private func generateProtectRegimeEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Security official seeking to protect current leadership
        guard (character.positionIndex ?? 0) >= 4 else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Regime Security Assessment",
            briefText: "\(character.name) has prepared an assessment of threats to the current leadership structure. They identify internal factions, foreign influence operations, and potential coup plotters. They seek your input on prioritizing countermeasures.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "support_measures",
                    text: "Endorse the security measures",
                    shortText: "Endorse",
                    effects: ["stability": 5, "partyOrthodoxy": 3]
                ),
                EventResponse(
                    id: "suggest_caution",
                    text: "Suggest more cautious approach",
                    shortText: "Caution",
                    effects: [:]
                ),
                EventResponse(
                    id: "question_motives",
                    text: "Question their true motives",
                    shortText: "Question",
                    effects: ["standing": -3]
                )
            ],
            iconName: "building.columns.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateEliminateRivalsEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Security official using apparatus against personal enemies
        guard let targetId = goal.targetCharacterId,
              let target = game.characters.first(where: { $0.id.uuidString == targetId }) else { return nil }

        // Only generate if player is close to the security official
        guard character.disposition >= 50 else { return nil }

        return DynamicEvent(
            eventType: .networkIntel,
            priority: .elevated,
            title: "Security Action Against \(target.name)",
            briefText: "\(character.name) is using their security position to move against \(target.name). The investigation appears politically motivated rather than based on genuine evidence. They've asked for your cooperation in building the case.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "join_scheme",
                    text: "Cooperate with the scheme",
                    shortText: "Cooperate",
                    effects: ["standing": -5]
                ),
                EventResponse(
                    id: "expose_abuse",
                    text: "Expose the abuse of power",
                    shortText: "Expose",
                    effects: ["standing": 10, "partyOrthodoxy": 5]
                ),
                EventResponse(
                    id: "stay_uninvolved",
                    text: "Stay uninvolved",
                    shortText: "Uninvolved",
                    effects: [:]
                )
            ],
            iconName: "person.fill.xmark",
            accentColor: "sovietRed"
        )
    }

    private func generateHuntForeignSpiesEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // MSS counter-intelligence - looking for spies
        let potentialSpies = game.characters.filter { other in
            other.isActive && other.foreignAgentStatus.isForeignAgent
        }

        // Random chance to discover a real spy or create false accusation
        let hasRealSpy = !potentialSpies.isEmpty && Int.random(in: 0...100) < 50
        let suspect = hasRealSpy
            ? potentialSpies.randomElement()
            : game.characters.filter { $0.isActive && $0.disposition < 40 }.randomElement()

        guard let suspectCharacter = suspect else { return nil }

        return DynamicEvent(
            eventType: .urgentInterruption,
            priority: .critical,
            title: "Counter-Intelligence Alert",
            briefText: "\(character.name) from the security services reports detecting foreign intelligence activity. Suspicion has fallen on \(suspectCharacter.name). They request authorization for intensive surveillance and potential detention.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: true,
            responseOptions: [
                EventResponse(
                    id: "authorize_detention",
                    text: "Authorize immediate detention",
                    shortText: "Detain",
                    effects: ["stability": -5, "standing": 5]
                ),
                EventResponse(
                    id: "surveillance_only",
                    text: "Authorize surveillance only",
                    shortText: "Surveil",
                    effects: [:]
                ),
                EventResponse(
                    id: "demand_evidence",
                    text: "Demand concrete evidence first",
                    shortText: "Evidence",
                    effects: ["standing": 3]
                ),
                EventResponse(
                    id: "protect_suspect",
                    text: "Vouch for \(suspectCharacter.name)",
                    shortText: "Protect",
                    effects: ["standing": -10]
                )
            ],
            iconName: "eye.trianglebadge.exclamationmark.fill",
            accentColor: "sovietRed"
        )
    }

    // MARK: - Economic Goal Events

    private func generateMeetQuotasEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Production officials reporting on quota progress
        let frustrated = goal.isFrustrated
        let success = Int.random(in: 0...100) < (frustrated ? 40 : 70)

        let title = success ? "Quota Fulfillment Report" : "Production Shortfall Alert"
        let text = success
            ? "\(character.name) reports that production quotas in their sector have been successfully met. They request recognition for their planning achievements and seek additional resource allocations for the next period."
            : "\(character.name) reports critical shortfalls in meeting production quotas. They are seeking emergency resource allocations and political cover to avoid blame for the failures."

        return DynamicEvent(
            eventType: .characterMessage,
            priority: success ? .normal : .elevated,
            title: title,
            briefText: text,
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: !success,
            responseOptions: [
                EventResponse(
                    id: "commend",
                    text: success ? "Commend their achievement" : "Accept their explanation",
                    shortText: success ? "Commend" : "Accept",
                    effects: success ? ["standing": 3] : ["stability": -3]
                ),
                EventResponse(
                    id: "investigate",
                    text: "Order an investigation into the numbers",
                    shortText: "Investigate",
                    effects: ["standing": -5]
                )
            ],
            iconName: "chart.bar.fill",
            accentColor: "accentGold"
        )
    }

    private func generateExceedQuotaEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        // Stakhanovite-style overachievement
        let success = Int.random(in: 0...100) < 45

        guard success else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Stakhanovite Achievement!",
            briefText: "\(character.name) has dramatically exceeded their production quota, achieving heroic worker status. They seek public recognition and rewards, hoping this success will advance their career in economic planning.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "celebrate",
                    text: "Publicly celebrate their achievement",
                    shortText: "Celebrate",
                    effects: ["popularSupport": 5, "industrialOutput": 3, "standing": 5]
                ),
                EventResponse(
                    id: "verify",
                    text: "Verify the numbers before celebrating",
                    shortText: "Verify",
                    effects: [:]
                ),
                EventResponse(
                    id: "minimize",
                    text: "Downplay to avoid embarrassing others",
                    shortText: "Minimize",
                    effects: ["standing": -3]
                )
            ],
            iconName: "star.fill",
            accentColor: "accentGold"
        )
    }

    private func generateExpandIndustrialEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Industrial Expansion Proposal",
            briefText: "\(character.name) has submitted a proposal to expand industrial capacity in their sector. The plan requires significant treasury investment but promises long-term production gains.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "approve",
                    text: "Approve the expansion",
                    shortText: "Approve",
                    effects: ["treasury": -10, "industrialOutput": 8]
                ),
                EventResponse(
                    id: "defer",
                    text: "Defer for further study",
                    shortText: "Defer",
                    effects: [:]
                ),
                EventResponse(
                    id: "reject",
                    text: "Reject as too costly",
                    shortText: "Reject",
                    effects: ["treasury": 3]
                )
            ],
            iconName: "building.2.fill",
            accentColor: "accentGold"
        )
    }

    private func generateModernizeSectorEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Modernization Initiative",
            briefText: "\(character.name) proposes a comprehensive modernization program for their sector. This would require importing foreign technology and training workers in new methods - potentially controversial but promising significant efficiency gains.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "support",
                    text: "Support the modernization",
                    shortText: "Support",
                    effects: ["treasury": -8, "industrialOutput": 5, "internationalStanding": 3]
                ),
                EventResponse(
                    id: "limited",
                    text: "Approve limited modernization",
                    shortText: "Limited",
                    effects: ["treasury": -3, "industrialOutput": 2]
                ),
                EventResponse(
                    id: "ideological",
                    text: "Reject as ideologically dangerous",
                    shortText: "Reject",
                    effects: ["eliteLoyalty": 3, "industrialOutput": -2]
                )
            ],
            iconName: "gearshape.arrow.triangle.2.circlepath",
            accentColor: "accentGold"
        )
    }

    private func generateAcquireResourcesEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        let urgent = game.industrialOutput < 40

        return DynamicEvent(
            eventType: .characterMessage,
            priority: urgent ? .elevated : .normal,
            title: "Resource Allocation Request",
            briefText: "\(character.name) is requesting priority resource allocation for their sector. They argue that increased raw materials and labor would significantly boost production, but this would require diverting resources from other sectors.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: urgent,
            responseOptions: [
                EventResponse(
                    id: "full_allocation",
                    text: "Grant full allocation",
                    shortText: "Full",
                    effects: ["industrialOutput": 5, "eliteLoyalty": -3]
                ),
                EventResponse(
                    id: "partial",
                    text: "Grant partial allocation",
                    shortText: "Partial",
                    effects: ["industrialOutput": 2]
                ),
                EventResponse(
                    id: "deny",
                    text: "Deny the request",
                    shortText: "Deny",
                    effects: ["standing": -3]
                )
            ],
            iconName: "shippingbox.fill",
            accentColor: "accentGold"
        )
    }

    private func generateProtectBudgetEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Budget Defense Appeal",
            briefText: "\(character.name) is lobbying to protect their ministry's budget allocation from proposed cuts. They warn that reduced funding would cripple production capacity and result in missed quotas.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "protect",
                    text: "Shield their budget",
                    shortText: "Protect",
                    effects: ["treasury": -5, "standing": 3]
                ),
                EventResponse(
                    id: "small_cut",
                    text: "Impose modest cuts",
                    shortText: "Small Cut",
                    effects: ["treasury": 3, "industrialOutput": -2]
                ),
                EventResponse(
                    id: "major_cut",
                    text: "Proceed with major cuts",
                    shortText: "Major Cut",
                    effects: ["treasury": 8, "industrialOutput": -5, "standing": -5]
                )
            ],
            iconName: "banknote.fill",
            accentColor: "accentGold"
        )
    }

    private func generateBuildEconomicNetworkEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Economic Planning Connections",
            briefText: "\(character.name) is seeking to expand their network of planning contacts. They've approached you to discuss mutual cooperation on economic initiatives - a relationship that could benefit both parties.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "ally",
                    text: "Agree to cooperation",
                    shortText: "Cooperate",
                    effects: ["network": 5, "standing": 3]
                ),
                EventResponse(
                    id: "cautious",
                    text: "Express cautious interest",
                    shortText: "Cautious",
                    effects: ["network": 2]
                ),
                EventResponse(
                    id: "decline",
                    text: "Politely decline",
                    shortText: "Decline",
                    effects: [:]
                )
            ],
            iconName: "person.3.fill",
            accentColor: "accentGold"
        )
    }

    private func generateAdvanceEconomicReformEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Economic Reform Proposal",
            briefText: "\(character.name) has drafted a controversial proposal for economic reform. The changes would introduce market elements to improve efficiency, but could be seen as ideologically dangerous. They're seeking political support before presenting it to the Standing Committee.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(
                    id: "champion",
                    text: "Champion the reform",
                    shortText: "Champion",
                    effects: ["industrialOutput": 5, "eliteLoyalty": -8, "stability": -5, "standing": 10]
                ),
                EventResponse(
                    id: "modify",
                    text: "Support with modifications",
                    shortText: "Modify",
                    effects: ["industrialOutput": 2, "eliteLoyalty": -3]
                ),
                EventResponse(
                    id: "oppose",
                    text: "Oppose as revisionist",
                    shortText: "Oppose",
                    effects: ["eliteLoyalty": 5, "standing": 3]
                )
            ],
            iconName: "arrow.3.trianglepath",
            accentColor: "sovietRed"
        )
    }

    // MARK: - Military-Political Goal Events

    private func generateEnsurePartyCommandEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Party Command Reinforcement",
            briefText: "\(character.name), a political commissar, is organizing an intensive campaign to reinforce the principle that the Party commands the gun. They've requested your support in emphasizing dual command structure.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "support", text: "Actively support the campaign", shortText: "Support", effects: ["militaryLoyalty": 5, "standing": 5]),
                EventResponse(id: "participate", text: "Participate nominally", shortText: "Participate", effects: ["standing": 2]),
                EventResponse(id: "decline", text: "Decline involvement", shortText: "Decline", effects: ["standing": -3])
            ],
            iconName: "shield.lefthalf.filled",
            accentColor: "sovietRed"
        )
    }

    private func generateConductPoliticalWorkEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Political Work Initiative",
            briefText: "\(character.name) is launching a new political education initiative in their military unit. They want to know if you'll endorse their ideological curriculum to the Political Work Department.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "endorse", text: "Endorse enthusiastically", shortText: "Endorse", effects: ["militaryLoyalty": 3, "standing": 3]),
                EventResponse(id: "review", text: "Request review first", shortText: "Review", effects: ["standing": 1]),
                EventResponse(id: "ignore", text: "Decline to endorse", shortText: "Decline", effects: ["standing": -2])
            ],
            iconName: "book.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateEvaluateOfficerLoyaltyEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Loyalty Evaluation Request",
            briefText: "\(character.name) is conducting political reliability evaluations in their command. They've asked for your assessment of certain officers' loyalty, which will go into their political dossiers.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "provide", text: "Provide frank assessment", shortText: "Provide", effects: ["standing": 5, "network": 3]),
                EventResponse(id: "cautious", text: "Give cautious evaluation", shortText: "Cautious", effects: ["standing": 2]),
                EventResponse(id: "refuse", text: "Refuse to participate", shortText: "Refuse", effects: ["standing": -5])
            ],
            iconName: "person.badge.shield.checkmark.fill",
            accentColor: "sovietRed"
        )
    }

    private func generatePurgeDisloyalEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .urgent,
            title: "Purge Recommendation",
            briefText: "\(character.name) has identified officers they believe are politically unreliable and is recommending their removal. They're seeking support to bring the case before the Party committee.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: true,
            responseOptions: [
                EventResponse(id: "support", text: "Support the purge", shortText: "Support", effects: ["militaryLoyalty": -5, "eliteLoyalty": -8, "standing": 10]),
                EventResponse(id: "investigate", text: "Call for investigation first", shortText: "Investigate", effects: ["standing": 3]),
                EventResponse(id: "oppose", text: "Oppose as excessive", shortText: "Oppose", effects: ["eliteLoyalty": 5, "standing": -5])
            ],
            iconName: "person.fill.xmark",
            accentColor: "sovietRed"
        )
    }

    private func generateEnforcePartyDisciplineEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Discipline Enforcement",
            briefText: "\(character.name) is cracking down on discipline violations in their unit. They want your backing to implement stricter political regulations and enforce Party standards.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "back", text: "Fully back stricter discipline", shortText: "Back", effects: ["militaryLoyalty": 5, "stability": 3, "standing": 3]),
                EventResponse(id: "moderate", text: "Suggest moderation", shortText: "Moderate", effects: ["stability": 2]),
                EventResponse(id: "oppose", text: "Oppose harsh measures", shortText: "Oppose", effects: ["eliteLoyalty": 3, "standing": -3])
            ],
            iconName: "hand.raised.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateBuildCommissarNetworkEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Commissar Alliance",
            briefText: "\(character.name) is building connections among political commissars across different units. They're inviting you to join a network of commissars who coordinate political work.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "join", text: "Join the network actively", shortText: "Join", effects: ["network": 8, "standing": 3]),
                EventResponse(id: "observe", text: "Participate as observer", shortText: "Observe", effects: ["network": 3]),
                EventResponse(id: "decline", text: "Decline membership", shortText: "Decline", effects: ["standing": -2])
            ],
            iconName: "person.3.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateAdvanceMilitaryReformEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Military Reform Proposal",
            briefText: "\(character.name) has drafted a proposal to restructure the military's political work system, similar to recent PLA reforms. The changes would consolidate commissar authority but face resistance from traditionalists.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "champion", text: "Champion the reform", shortText: "Champion", effects: ["militaryLoyalty": -3, "eliteLoyalty": -5, "standing": 12]),
                EventResponse(id: "modify", text: "Support with modifications", shortText: "Modify", effects: ["standing": 5]),
                EventResponse(id: "oppose", text: "Oppose as destabilizing", shortText: "Oppose", effects: ["eliteLoyalty": 5, "standing": -3])
            ],
            iconName: "arrow.3.trianglepath",
            accentColor: "sovietRed"
        )
    }

    private func generatePreventMilitaryCoupEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .urgent,
            title: "Coup Prevention Measures",
            briefText: "\(character.name) has detected concerning patterns suggesting military officers may be coordinating outside Party channels. They want to implement enhanced political monitoring to prevent any threat to Party control.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: true,
            responseOptions: [
                EventResponse(id: "support", text: "Support enhanced monitoring", shortText: "Support", effects: ["militaryLoyalty": 8, "eliteLoyalty": -10, "stability": -5, "standing": 8]),
                EventResponse(id: "investigate", text: "Investigate quietly first", shortText: "Investigate", effects: ["standing": 3]),
                EventResponse(id: "dismiss", text: "Dismiss as paranoia", shortText: "Dismiss", effects: ["eliteLoyalty": 5, "standing": -5])
            ],
            iconName: "exclamationmark.shield.fill",
            accentColor: "sovietRed"
        )
    }

    // MARK: - Party Apparatus Goal Events

    private func generateControlNomenklaturaEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Nomenklatura Control Initiative",
            briefText: "\(character.name) from the Organization Department is reviewing the nomenklatura lists. They want to ensure proper Party control over all key appointments and are seeking your input on personnel standards.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "support", text: "Support stricter Party control", shortText: "Support", effects: ["eliteLoyalty": 5, "standing": 4]),
                EventResponse(id: "moderate", text: "Suggest balanced approach", shortText: "Balance", effects: ["standing": 2]),
                EventResponse(id: "oppose", text: "Advocate for merit over politics", shortText: "Merit", effects: ["eliteLoyalty": -5, "standing": -2])
            ],
            iconName: "person.crop.rectangle.stack.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateEnforcePropagandaLineEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Propaganda Line Enforcement",
            briefText: "\(character.name) from the Propaganda Department has detected deviations from the correct ideological line in local media. They're organizing a campaign to ensure all outlets follow Central Committee messaging.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "support", text: "Support propaganda enforcement", shortText: "Enforce", effects: ["popularSupport": -3, "eliteLoyalty": 5, "standing": 4]),
                EventResponse(id: "moderate", text: "Suggest subtle correction", shortText: "Subtle", effects: ["standing": 2]),
                EventResponse(id: "oppose", text: "Warn against heavy-handedness", shortText: "Caution", effects: ["popularSupport": 3, "eliteLoyalty": -3])
            ],
            iconName: "megaphone.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateConductUnitedFrontWorkEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "United Front Outreach",
            briefText: "\(character.name) from the United Front Work Department is expanding Party influence among non-party groups. They're organizing outreach to intellectuals, business leaders, and religious figures.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "support", text: "Support united front expansion", shortText: "Expand", effects: ["popularSupport": 5, "network": 3, "standing": 4]),
                EventResponse(id: "targeted", text: "Focus on specific groups", shortText: "Target", effects: ["network": 5, "standing": 2]),
                EventResponse(id: "caution", text: "Warn of ideological contamination", shortText: "Caution", effects: ["eliteLoyalty": 3, "standing": -2])
            ],
            iconName: "person.3.sequence.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateRunPartySchoolEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Party School Program",
            briefText: "\(character.name) from the Central Party School is expanding cadre training programs. They want to ensure all officials receive proper ideological education and are seeking your endorsement.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "support", text: "Strongly support training expansion", shortText: "Support", effects: ["eliteLoyalty": 8, "standing": 5]),
                EventResponse(id: "practical", text: "Suggest practical focus", shortText: "Practical", effects: ["standing": 3, "eliteLoyalty": -2]),
                EventResponse(id: "neutral", text: "Take no position", shortText: "Neutral", effects: [:])
            ],
            iconName: "graduationcap.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateMaintainPartyDisciplineEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Party Discipline Review",
            briefText: "\(character.name) is conducting a review of Party discipline. They want to organize self-criticism sessions and ensure all members follow Party regulations strictly.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "strict", text: "Support strict discipline measures", shortText: "Strict", effects: ["stability": 5, "eliteLoyalty": -5, "standing": 4]),
                EventResponse(id: "moderate", text: "Suggest measured approach", shortText: "Moderate", effects: ["stability": 2, "standing": 2]),
                EventResponse(id: "lenient", text: "Advocate for leniency", shortText: "Lenient", effects: ["eliteLoyalty": 5, "stability": -3, "standing": -2])
            ],
            iconName: "checkmark.shield.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateExpandPartyInfluenceEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Expanding Party Presence",
            briefText: "\(character.name) is working to expand Party influence into new areas of society. They're establishing Party cells in workplaces, schools, and community organizations.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "aggressive", text: "Support aggressive expansion", shortText: "Expand", effects: ["popularSupport": -5, "eliteLoyalty": 8, "standing": 5]),
                EventResponse(id: "organic", text: "Prefer organic growth", shortText: "Organic", effects: ["popularSupport": 3, "standing": 2]),
                EventResponse(id: "oppose", text: "Warn of overreach", shortText: "Caution", effects: ["popularSupport": 5, "eliteLoyalty": -5, "standing": -3])
            ],
            iconName: "star.fill",
            accentColor: "sovietRed"
        )
    }

    private func generateBuildCadreNetworkEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        guard character.disposition >= 30 else { return nil }

        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Cadre Network Building",
            briefText: "\(character.name) is cultivating relationships among Party officials. They've approached you about joining a network of like-minded cadres who support each other's advancement.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "join", text: "Join their network", shortText: "Join", effects: ["network": 8, "standing": 4]),
                EventResponse(id: "consider", text: "Express interest cautiously", shortText: "Consider", effects: ["network": 3]),
                EventResponse(id: "decline", text: "Decline politely", shortText: "Decline", effects: ["standing": -2])
            ],
            iconName: "person.3.fill",
            accentColor: "sovietRed"
        )
    }

    private func generatePurgeDeviationistsEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Purge of Deviationists",
            briefText: "\(character.name) has identified officials who deviate from the correct Party line. They're organizing a campaign to remove these 'deviationists' and are seeking your support for this purification effort.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: true,
            responseOptions: [
                EventResponse(id: "support", text: "Support the purge enthusiastically", shortText: "Purge", effects: ["stability": -8, "eliteLoyalty": -10, "standing": 10]),
                EventResponse(id: "targeted", text: "Support targeted action only", shortText: "Targeted", effects: ["stability": -3, "standing": 5]),
                EventResponse(id: "oppose", text: "Oppose as destabilizing", shortText: "Oppose", effects: ["eliteLoyalty": 5, "standing": -5])
            ],
            iconName: "xmark.circle.fill",
            accentColor: "sovietRed"
        )
    }

    // MARK: - State Ministry Goal Events

    private func generateAdministrativeExcellenceEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Administrative Excellence Initiative",
            briefText: "\(character.name) has developed a comprehensive plan to improve ministry efficiency and streamline bureaucratic procedures. They're seeking your endorsement for this administrative excellence initiative.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "support", text: "Fully support the initiative", shortText: "Support", effects: ["stability": 3, "standing": 5]),
                EventResponse(id: "modify", text: "Suggest modifications", shortText: "Modify", effects: ["standing": 2, "network": 2]),
                EventResponse(id: "defer", text: "Defer to higher authority", shortText: "Defer", effects: [:])
            ],
            iconName: "building.columns.fill",
            accentColor: "governmentBlue"
        )
    }

    private func generateSecureBudgetEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Budget Allocation Request",
            briefText: "\(character.name) is working to secure adequate funding for their ministry in the upcoming budget cycle. They've approached you to support their budget request before the Finance Ministry.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "support", text: "Support their budget request", shortText: "Support", effects: ["treasury": -2, "network": 5]),
                EventResponse(id: "partial", text: "Support partial funding", shortText: "Partial", effects: ["network": 2]),
                EventResponse(id: "oppose", text: "Oppose increased funding", shortText: "Oppose", effects: ["treasury": 2, "network": -3])
            ],
            iconName: "banknote.fill",
            accentColor: "governmentBlue"
        )
    }

    private func generateAdvanceProjectEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Major State Project Proposal",
            briefText: "\(character.name) is championing a major infrastructure project that would significantly impact their ministry's portfolio. They need political support to move the project forward through State Council approval.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "champion", text: "Champion the project", shortText: "Champion", effects: ["treasury": -5, "industrialOutput": 5, "standing": 8]),
                EventResponse(id: "support", text: "Provide quiet support", shortText: "Support", effects: ["industrialOutput": 2, "standing": 3]),
                EventResponse(id: "oppose", text: "Oppose as too costly", shortText: "Oppose", effects: ["treasury": 3, "standing": -5])
            ],
            iconName: "building.2.fill",
            accentColor: "governmentBlue"
        )
    }

    private func generateCoordinateMinistriesEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Inter-Ministry Coordination",
            briefText: "\(character.name) has taken on the difficult task of coordinating policy across multiple ministries. They're asking for your help navigating bureaucratic resistance and building consensus.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "assist", text: "Actively assist coordination", shortText: "Assist", effects: ["stability": 2, "network": 5, "standing": 3]),
                EventResponse(id: "advise", text: "Offer strategic advice", shortText: "Advise", effects: ["network": 2]),
                EventResponse(id: "decline", text: "Decline involvement", shortText: "Decline", effects: [:])
            ],
            iconName: "arrow.triangle.merge",
            accentColor: "governmentBlue"
        )
    }

    private func generateImplementStatePolicyEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "State Council Policy Implementation",
            briefText: "\(character.name) has been tasked with implementing a major State Council policy directive. They're facing resistance from local officials and need support to ensure compliance.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "enforce", text: "Help enforce compliance", shortText: "Enforce", effects: ["stability": 3, "standing": 5, "eliteLoyalty": -2]),
                EventResponse(id: "negotiate", text: "Help negotiate with resisters", shortText: "Negotiate", effects: ["stability": 1, "network": 3]),
                EventResponse(id: "observe", text: "Observe from a distance", shortText: "Observe", effects: [:])
            ],
            iconName: "checkmark.seal.fill",
            accentColor: "governmentBlue"
        )
    }

    private func generateAuditUnitsEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .elevated,
            title: "Ministry Audit Initiative",
            briefText: "\(character.name) is conducting an audit of subordinate departments to identify inefficiencies and irregularities. They've discovered concerning findings and are deciding how to proceed.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "expose", text: "Encourage full exposure", shortText: "Expose", effects: ["stability": 2, "eliteLoyalty": -5, "standing": 8]),
                EventResponse(id: "quiet", text: "Handle quietly within ministry", shortText: "Quiet", effects: ["stability": -1, "network": 3]),
                EventResponse(id: "suppress", text: "Advise suppressing findings", shortText: "Suppress", effects: ["stability": -3, "eliteLoyalty": 3, "standing": -5])
            ],
            iconName: "doc.text.magnifyingglass",
            accentColor: "governmentBlue"
        )
    }

    private func generateModernizeAdminEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Administrative Reform Proposal",
            briefText: "\(character.name) is pushing for modernization of administrative procedures and structures. This reform could improve efficiency but threatens entrenched interests in the bureaucracy.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "champion", text: "Champion the reforms", shortText: "Champion", effects: ["stability": -3, "industrialOutput": 3, "standing": 10]),
                EventResponse(id: "support", text: "Offer quiet support", shortText: "Support", effects: ["standing": 3]),
                EventResponse(id: "oppose", text: "Oppose as destabilizing", shortText: "Oppose", effects: ["stability": 2, "eliteLoyalty": 5, "standing": -5])
            ],
            iconName: "arrow.triangle.2.circlepath",
            accentColor: "governmentBlue"
        )
    }

    private func generateBuildBureaucraticNetworkEvent(character: GameCharacter, goal: NPCGoal, game: Game) -> DynamicEvent? {
        return DynamicEvent(
            eventType: .characterMessage,
            priority: .normal,
            title: "Bureaucratic Alliance Proposal",
            briefText: "\(character.name) is cultivating connections across the state apparatus and seeks to include you in their network of bureaucratic allies. Such connections could prove valuable for future administrative work.",
            initiatingCharacterId: character.id,
            initiatingCharacterName: character.name,
            turnGenerated: game.turnNumber,
            isUrgent: false,
            responseOptions: [
                EventResponse(id: "join", text: "Join their network", shortText: "Join", effects: ["network": 8, "standing": 2]),
                EventResponse(id: "informal", text: "Maintain informal ties", shortText: "Informal", effects: ["network": 3]),
                EventResponse(id: "decline", text: "Decline entanglement", shortText: "Decline", effects: [:])
            ],
            iconName: "person.3.fill",
            accentColor: "governmentBlue"
        )
    }

    // MARK: - Helper Methods

    /// Map goal type to decision type for the protocol
    private func mapGoalToDecisionType(_ goalType: NPCGoalType) -> NPCDecisionType {
        switch goalType {
        case .seekPromotion, .becomeTrackHead, .joinPolitburo, .protectPosition:
            return .goalPursuit
        case .destroyRival, .avengeBetrayal:
            return .rivalAttack
        case .elevateAlly, .repayDebt:
            return .allyAssistance
        case .buildFaction, .expandInfluence:
            return .coalitionBuilding
        case .implementReform, .maintainOrthodoxy, .purgeEnemies:
            return .policyProposal
        case .serveTheParty, .defendPartyOrthodoxy, .rootOutTraitors, .strengthenTheState:
            return .goalPursuit
        case .spyForForeignPower, .sabotageFromWithin, .avoidDetection:
            return .spyActivity
        case .recruitAssets:
            return .recruitment
        case .avoidPurge, .clearName, .escapeDetention, .findProtector:
            return .survivalAction
        case .accumulateWealth:
            return .goalPursuit
        // Diplomatic goals
        case .improveAllyRelations, .containCapitalistThreat, .expandTradeNetwork,
             .defuseInternationalCrisis, .advanceIdeologicalGoals, .negotiateTreaty:
            return .goalPursuit
        case .proposeForeignPolicy:
            return .policyProposal
        // Security goals (CCDI/MSS)
        case .investigateCorruption, .expandSurveillance, .conductPurge,
             .protectRegime, .huntForeignSpies:
            return .goalPursuit
        case .buildDossiers, .protectPatron:
            return .coalitionBuilding
        case .eliminateRivals:
            return .rivalAttack
        // Economic goals (Gosplan)
        case .meetProductionQuotas, .exceedException, .expandIndustrialOutput,
             .modernizeSector, .acquireResources, .protectBudgetAllocation:
            return .goalPursuit
        case .buildEconomicNetwork:
            return .coalitionBuilding
        case .advanceEconomicReform:
            return .policyProposal
        // Military-Political goals (PLA Commissar)
        case .ensurePartyCommand, .conductPoliticalWork, .evaluateOfficerLoyalty,
             .enforcePartyDiscipline, .preventMilitaryCoup:
            return .goalPursuit
        case .purgeDisloyal:
            return .rivalAttack
        case .buildCommissarNetwork:
            return .coalitionBuilding
        case .advanceMilitaryReform:
            return .policyProposal
        // Party Apparatus goals (Organization Department/Central Committee)
        case .controlNomenklatura, .runPartySchool, .maintainPartyDiscipline,
             .expandPartyInfluence, .enforcePropagandaLine, .conductUnitedFrontWork:
            return .goalPursuit
        case .buildCadreNetwork:
            return .coalitionBuilding
        case .purgeDeviationists:
            return .rivalAttack

        // State Ministry Goals
        case .achieveAdministrativeExcellence, .implementStatePolicy, .modernizeAdministration,
             .coordinateAcrossMinistries, .secureBudgetAllocation, .advanceMajorProject:
            return .goalPursuit
        case .auditSubordinateUnits:
            return .rivalAttack
        case .buildBureaucraticNetwork:
            return .coalitionBuilding
        }
    }
}

// MARK: - GameCharacter Extensions for Goal Service

extension GameCharacter {
    /// Convenience property to access goals array
    var goals: [NPCGoal]? {
        let goals = npcGoals
        return goals.isEmpty ? nil : goals
    }

    /// Convenience property to access needs
    var needs: NPCNeeds? {
        return npcNeeds
    }

    /// Whether character is under investigation
    var isUnderInvestigation: Bool {
        // Check for investigation-related memories or status
        return npcMemoriesEnhanced.contains { $0.memoryType == .wasInvestigated && $0.isSignificant }
    }
}
